<!DOCTYPE html>
<meta charset="utf-8">

<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://cdn.jsdelivr.net/gh/holtzy/D3-graph-gallery@master/LIB/d3.layout.cloud.js"></script>

<div id="my_dataviz"></div>

<script>

  // List of words
  var myWords = ["Hello", "Everybody", "How", "Are", "You", "Today", "It", "Is", "A", "Lovely", "Day", "I", "Love", "Coding", "In", "My", "Van", "Mate"]
  
  // set the dimensions and margins of the graph
  var margin = {top: 10, right: 10, bottom: 10, left: 10},
      width = 450 - margin.left - margin.right,
      height = 450 - margin.top - margin.bottom;
  d3.csv("data.csv", function (error, data) {
    console.log(data)
    console.log(typeof data[0].termFreqs)

    var termFreqs_str = data[0].termFreqs
    var termFreqs_data = termFreqs_str.match(/\((.+?),(.+?)\)/g).map((value, index) => {
      value = value.replace(/\(|\)/gi, '')
      console.log(value)
      var term = value.split(",")[0]
      var freq = Number(value.split(",")[1])
      console.log(term, freq)

      return {text: term, freq: freq}
    })

    drawWordCloud(termFreqs_data)
  })


  var svg = d3.select("#my_dataviz").append("svg")
      .attr("width", width + margin.left + margin.right)
      .attr("height", height + margin.top + margin.bottom)
    .append("g")
      .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");
  
  function drawWordCloud(termFreqs) {
    console.log(termFreqs)

    wordScale = d3.scaleLinear().domain([0, 100]).range([0, 150]).clamp(true);
    var layout = d3.layout.cloud().size([width, height])
      .words(termFreqs)
      .fontSize(60)
      .padding(10)
      .on("end", draw);
    layout.start()

    function draw(words) {
      svg
        .append("g")
        .attr("transform", "translate(" + layout.size()[0] / 2 + "," + layout.size()[1] / 2 + ")")
        .selectAll("text")
          .data(words)
        .enter().append("text")
        .style("font-size", function(d) { return wordScale(d.freq) + "px"; })
        .attr("text-anchor", "middle")
        .attr("transform", function(d) {
          return "translate(" + [d.x, d.y] + ")rotate(" + d.rotate + ")";
        })
        .text(function(d) { return d.text; });
    }
  }
  </script>